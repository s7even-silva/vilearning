<div class="lab-workspace">
  <div class="lab-header">
    <h2>Laboratorio Activo</h2>
    <div class="header-actions">
      <button class="btn-finish" (click)="finishLab()">Finalizar Laboratorio</button>
    </div>
  </div>

  <div class="workspace-grid">

    <!-- Panel de c치mara con overlay -->
    <div class="camera-panel">
      <h3>Vista de C치mara</h3>
      <div class="camera-container">
        <!-- Video y Canvas overlay -->
        <div class="video-wrapper">
          <!-- Video oculto - MediaPipe lo usa como fuente -->
          <video
            #video
            style="display: none"
            width="640"
            height="480"
            autoplay>
          </video>

          <!-- Canvas overlay para dibujar la detecci칩n -->
          <canvas
            #canvas
            width="640"
            height="480"
            class="overlay-canvas">
          </canvas>
        </div>

        <!-- Estado de la detecci칩n -->
        <div class="detection-status">
          <span class="status-indicator" [class.active]="detectionState.handDetected"></span>
          @if (detectionState.handDetected) {
            <span>Mano detectada</span>
          } @else {
            <span>Esperando mano...</span>
          }
        </div>
      </div>
    </div>

    <!-- Panel de visualizaci칩n de la pr칩tesis (C치mara USB) -->
    <div class="hand-visualization-panel">
      <h3>Visualizaci칩n de la Mano</h3>
      <div class="usb-camera-container">
        <!-- Stream de la c치mara USB -->
        @if (!cameraStreamState.hasError) {
          <img
            #usbCamera
            [src]="cameraStreamState.url"
            alt="Vista de la pr칩tesis"
            class="usb-camera-stream"
            (load)="onCameraLoad()"
            (error)="onCameraError()"
          />
        }

        <!-- Estado de carga -->
        @if (!cameraStreamState.isLoaded && !cameraStreamState.hasError) {
          <div class="camera-status loading">
            <div class="spinner"></div>
            <p>Cargando stream de la pr칩tesis...</p>
          </div>
        }

        <!-- Estado de error -->
        @if (cameraStreamState.hasError) {
          <div class="camera-status error">
            <div class="error-icon">丘멆잺</div>
            <p>{{ cameraStreamState.errorMessage || 'No se pudo cargar el stream' }}</p>
            <button class="btn-retry" (click)="retryCameraStream()">
              游댃 Reintentar
            </button>
          </div>
        }

        <!-- Indicador de stream activo -->
        @if (cameraStreamState.isLoaded) {
          <div class="stream-indicator">
            <span class="live-badge">游댮 EN VIVO</span>
          </div>
        }

        <!-- Gesto detectado -->
        <div class="gesture-display">
          <h4>Gesto Actual:</h4>
          <p class="gesture-text">{{ detectionState.currentGesture }}</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Panel de estado de dedos -->
  <div class="finger-status-panel">
    <h3>Estado de los Dedos</h3>
    <div class="finger-grid">
      <div class="finger-item" [class.active]="detectionState.fingerStates.thumb">
        <span class="finger-icon">游녨</span>
        <span class="finger-label">Pulgar</span>
        <span class="finger-state">{{ detectionState.fingerStates.thumb ? 'Extendido' : 'Contra칤do' }}</span>
      </div>
      <div class="finger-item" [class.active]="detectionState.fingerStates.index">
        <span class="finger-icon">驕뢢잺</span>
        <span class="finger-label">칈ndice</span>
        <span class="finger-state">{{ detectionState.fingerStates.index ? 'Extendido' : 'Contra칤do' }}</span>
      </div>
      <div class="finger-item" [class.active]="detectionState.fingerStates.middle">
        <span class="finger-icon">游둣</span>
        <span class="finger-label">Medio</span>
        <span class="finger-state">{{ detectionState.fingerStates.middle ? 'Extendido' : 'Contra칤do' }}</span>
      </div>
      <div class="finger-item" [class.active]="detectionState.fingerStates.ring">
        <span class="finger-icon">游눐</span>
        <span class="finger-label">Anular</span>
        <span class="finger-state">{{ detectionState.fingerStates.ring ? 'Extendido' : 'Contra칤do' }}</span>
      </div>
      <div class="finger-item" [class.active]="detectionState.fingerStates.pinky">
        <span class="finger-icon">游뱇</span>
        <span class="finger-label">Me침ique</span>
        <span class="finger-state">{{ detectionState.fingerStates.pinky ? 'Extendido' : 'Contra칤do' }}</span>
      </div>
    </div>
  </div>
</div>
